.\" Automatically generated by Pandoc 2.5
.\"
.TH "RAPIDDISK\-ON\-BOOT" "1" "2022\-05\-30" "GNU" ""
.hy
.SH NAME
.PP
rapiddisk\-on\-boot \- a simple bash script to add rapiddisk cache to
your root volume
.SH SYNOPSIS
.PP
\f[B]rapiddisk\-on\-boot\f[R] \f[B]\-\-install\f[R]
[\f[B]\-\-root=\f[R]\f[I]root_partition\f[R]]
\f[B]\-\-size=\f[R]\f[I]ramdisk_size\f[R]
\f[B]\-\-kernel=\f[R]\f[I]kernel_version\f[R]
\f[B]\-\-cache\-mode=\f[R]\f[I]mode\f[R] [\f[B]\-\-force\f[R]]
.PD 0
.P
.PD
\f[B]rapiddisk\-on\-boot\f[R] \f[B]\-\-uninstall\f[R]
\f[B]\-\-kernel=\f[R]\f[I]kernel_version\f[R] [\f[B]\-\-force\f[R]]
.PD 0
.P
.PD
\f[B]rapiddisk\-on\-boot\f[R] \f[B]\-\-global\-uninstall\f[R]
.SH DESCRIPTION
.PP
To be able to map a rapiddisk cache to your \[ga]/\[ga] volume to speed
it up, the filesystem has to be umounted, and this is not possible.
So, the mapping must happen at boot time, before \[ga]/\[ga] is mounted.
This script adds the correct initrd related files to the system, and
recreates the initrd file(s) used at boot, so that, upon the next
reboot, \[ga]/\[ga] will end up mounted on a rapiddisk cached device.
.SS Long story
.PP
An initrd (intial ramdisk) file is a special kind of archive used during
boot.
The kernel, upon loading, may need to perform some actions before it can
mount the final root filesystem, such as loading furher kernel modules,
or make accessible a partition placed on a software RAID array.
To achieve these goals, an initrd file is specially crafted, so that the
kernel, upon boot, can load it, extract it to a ramdisk, mount it as a
temporary filesystem and access this preliminary boot environment to
perform the kind of operations described above.
\f[B]rapiddisk\-on\-boot\f[R] adds to this operation list the mapping of
a cache to the device where the root filesystem resides.
So that, when at last the root filesystem is mounted, it will be cached
by rapiddisk.
.SS System\-wide but kenel version\-wise
.PP
rapiddisk\[cq]s modules, like every kernel module, are specific for each
kernel version, so must be built and installed separately for each
kernel you want to use them with.
On the other hand, the tools used to create initrd files follow a
system\-wide rule set.
They are smart enough to choose the right module version to add for the
right kernel.
But there is no way to tell them to use a different rule set for each
kernel version.
So, for example, the boot\-time instruction to map a 100 MB ramdisk
cache to /dev/sda1 would be valid, and added, to every initrd files upon
re\-building, regardless of the kernel version it is built or rebuilt
for.
.PD 0
.P
.PD
This script alters this approach: the rule set remains system\-wide, but
allows the user to choose different options for each kernel version.
.SH OPTIONS
.SS Installing (\-\-install)
.PP
The installation process (\f[B]\-\-install\f[R] switch) can be performed
several times.
The options you provide will affect only one initrd file per time,
i.e.\ the one related to the specified kernel version
(\f[B]\-\-kernel\f[R] switch).
If you use the \f[B]\-\-install\f[R] option using a kernel version for
which a configuration was already created by
\f[B]rapiddisk\-on\-boot\f[R], it is mandatory to specify the
\f[B]\-\-force\f[R] argument too to overwrite the configuration.
.TP
.B \f[B]\-\-install\f[R]
triggers the installation mode
.TP
.B \f[B]\-\-root=\f[R]\f[I]root_partition\f[R]
must be equal to the root device where \[ga]/\[ga] is mounted, for
example \[ga]/dev/sda1\[ga].
If you omit this paramenter, the script will parse \[ga]/etc/fstab\[ga]
to find the correct device by itself, and ask for confirmation before
doing anything.
.TP
.B \f[B]\-\-size=\f[R]\f[I]ramdisk_size\f[R]
\f[I]ramdisk_size\f[R] indicates the number of megabyte rapiddisk will
use as cache for your root device.
For example \[ga]\[en]size=1000\[ga] means your cache will be 1 GB big.
.TP
.B \f[B]\-\-cache\-mode=\f[R]\f[I]mode\f[R]
\f[I]mode\f[R] indicates the caching behavoiur, must be \[ga]wt\[ga],
\[ga]wa\[ga] or \[ga]wb\[ga].
See \f[B]rapiddisk(1)\f[R]\[cq]s documentation for more.
.TP
.B \f[B]\-\-kernel=\f[R]\f[I]kernel_version\f[R]
instructs the script about which initrd file to update.
On many linux distributions there are more than one kernel version
installed at the same time, and there is one initrd file for each
version.
You can find the kernel version you are using with \[ga]uname \-r\[ga]
.TP
.B \f[B]\-\-force\f[R]
forces the script to perform a reinstall with the new parameters for the
specified kernel version.
It is mandatory when a configuration already exists for the provided
kernel version.
.SS Uninstalling (\-\-uninstall)
.PP
From the initrd file linked to the specified kernel version, the
rapiddisk cache creation will be removed.
If rapiddisk was installed for other kernel versions, those
installations will not be affected.
.TP
.B \f[B]\-\-uninstall\f[R]
this switch causes the script to alter the system\-wide rule set so that
rapiddisk will not be invoked at boot time \f[I]for the specified kernel
version only\f[R].
The system\-wide rule set is not removed, just altered, so that it is
possible to load rapiddisk on boot on different kernel versions
independently.
.TP
.B \f[B]\-\-kernel=\f[R]\f[I]kernel_version\f[R]
instructs the script about which initrd file to update.
.TP
.B \f[B]\-\-force\f[R]
trys to remove the installation even if it cannot be found.
.SS Global uninstalling (\-\-global\-uninstall)
.TP
.B \f[B]\-\-global\-uninstall\f[R]
This operation removes everything the script could have installed, and
rebuilds ALL the initrd files.
A complete uninstallation is performed.
.SH FILES
.PP
\f[I]/usr/share/rapiddisk\-on\-boot/*\f[R]
.SH NOTES
.PP
You can see the content of an initrd with \[ga]lsinitrd\[ga] on CentOS
and \[ga]lsinitramfs\[ga] on Ubuntu.
.SH BUGS
.PP
Under Centos 8, using xfs as the root filesystem, rapiddisk may not work
if write\-back mode is selected.
.SH EXAMPLES
.TP
.B \f[B]rapiddisk\-on\-boot \-\-install \-\-kernel=\[ga]uname \-r\[ga] \-\-root=/dev/sda1 \-\-cache\-mode=wa \-\-size=100\f[R]
on next boot with the current running kernel will be created a 100 MB
ramdisk and it will be attached to /dev/sda1
.TP
.B \f[B]rapiddisk\-on\-boot \-\-uninstall \-\-kernel=\[ga]uname \-r\[ga]\f[R]
removes creation of a rapiddisk cache at boot time for the current
running kernel
.TP
.B \f[B]rapiddisk\-on\-boot \-\-global\-uninstall\f[R]
removes any file installed for every installed kernel \- complete clean.
.SH SEE ALSO
.PP
\f[B]rapiddisk(1)\f[R]
.SH AUTHORS
Matteo Tenca (https://github.com/matteotenca).
